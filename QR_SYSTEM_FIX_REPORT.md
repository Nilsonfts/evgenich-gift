# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–µ—Ç—Ä–∏–∫ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º

## üìã –ü—Ä–æ–±–ª–µ–º–∞
–ü–µ—Ä–µ—Ö–æ–¥—ã –≥–æ—Å—Ç–µ–π –ø–æ QR-–∫–æ–¥–∞–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∑–∞—Å—á–∏—Ç—ã–≤–∞–ª–∏—Å—å –∫–∞–∫ "–¥–∏—Ä–µ–∫—Ç" –∏–ª–∏ "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫" –≤–º–µ—Å—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —É—á–µ—Ç–∞ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. üîç –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ QR-–∫–æ–¥–æ–≤ –≤ `handlers/user_commands.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ü—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫–æ–¥–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥ —Ç–µ–ø–µ—Ä—å –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "direct", –∞ –Ω–µ "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫"
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –î–æ–±–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –æ –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö –ø–æ QR-–∫–æ–¥–∞–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

```python
# –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
if staff_member:
    # ... –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞
else:
    source = f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫_{staff_code}"  # ‚ùå –ó–∞—Å–æ—Ä—è–ª–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

# –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
if staff_member:
    # ... –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤
else:
    source = 'direct'  # ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ "–ø—Ä—è–º—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã"
    brought_by_staff_id = None
```

### 2. üìä –£–ª—É—á—à–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏

**–í `database.py`:**
- –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_report_data_for_period()` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- QR-–∫–æ–¥—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞ "QR-–∫–æ–¥—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤"
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_staff_qr_diagnostics_for_period()` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–í `handlers/admin_panel.py`:**
- –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ QR-–∫–æ–¥–æ–≤ (`admin_staff_qr_diagnostics`)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∏—Ö –∫–æ–¥—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- –í—ã—è–≤–ª—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –∫–æ–¥–∞–º–∏

### 3. üîò –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

**–í `keyboards.py`:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ QR-–∫–æ–¥–æ–≤" –≤ –º–µ–Ω—é –æ—Ç—á–µ—Ç–æ–≤
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã QR-–∫–æ–¥–æ–≤

### 4. üß™ –°–æ–∑–¥–∞–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- `test_staff_qr_system.py` - –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã QR-–∫–æ–¥–æ–≤
- `simple_qr_test.py` - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- `create_test_db.py` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### ‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:**
   - QR-–∫–æ–¥ –Ω–∞–π–¥–µ–Ω ‚Üí –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É
   - QR-–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "direct"

2. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –æ—Ç—á–µ—Ç–∞—Ö:**
   - –ë–ª–æ–∫ "–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤" –Ω–µ –∑–∞—Å–æ—Ä—è–µ—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏
   - QR-–ø–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
   - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

3. **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
   - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö

### üìä –ü—Ä–∏–º–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã:

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –ò–≤–∞–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç QR-–∫–æ–¥: `https://t.me/EvgenichTapBarBot?start=w_IVAN2024`
2. –ì–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ
3. –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å –∫–æ–¥–æ–º `IVAN2024`
4. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å:
   - `source`: "–°–æ—Ç—Ä—É–¥–Ω–∏–∫: –ò–≤–∞–Ω –ü."
   - `brought_by_staff_id`: ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ò–≤–∞–Ω–∞
5. –í –æ—Ç—á–µ—Ç–µ –ø–µ—Ä–µ—Ö–æ–¥ –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ò–≤–∞–Ω—É –≤ –±–ª–æ–∫–µ "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∞"

## üîß –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ QR-–∫–æ–¥–æ–≤:**
   ```
   /admin ‚Üí üìä –û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Üí üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ QR-–∫–æ–¥–æ–≤
   ```

2. **–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:**
   ```
   /admin ‚Üí üìä –û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Üí üë∑ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
   ```

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:**
   ```bash
   python simple_qr_test.py
   ```

2. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
   ```bash
   python create_test_db.py
   ```

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ QR-–∫–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:
```
https://t.me/EvgenichTapBarBot?start=w_–ö–û–î_–°–û–¢–†–£–î–ù–ò–ö–ê
```

### –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –∫–æ–¥–µ:
```python
if payload.startswith('w_'):
    staff_code = payload.replace('w_', '')
    staff_member = database.find_staff_by_code(staff_code)
    if staff_member:
        # ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É
        brought_by_staff_id = staff_member['staff_id']
        source = f"–°–æ—Ç—Ä—É–¥–Ω–∏–∫: {staff_member['short_name']}"
    else:
        # ‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥ ‚Üí –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–∞–∫ direct
        source = 'direct'
        brought_by_staff_id = None
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- –¢–∞–±–ª–∏—Ü–∞ `staff`: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –∏ –∏—Ö –∫–æ–¥–∞—Ö
- –¢–∞–±–ª–∏—Ü–∞ `users`: –ø–æ–ª–µ `brought_by_staff_id` —Å–≤—è–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç—Ä–æ–∏—Ç—Å—è —á–µ—Ä–µ–∑ JOIN —ç—Ç–∏—Ö —Ç–∞–±–ª–∏—Ü

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –º–µ—Ç—Ä–∏–∫ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥—ã –ø–æ QR-–∫–æ–¥–∞–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
- ‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–¥—ã –Ω–µ –∑–∞—Å–æ—Ä—è—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏–º–µ—é—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!
