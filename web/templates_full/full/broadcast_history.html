{% extends "full/base.html" %}
{% block title %}–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫{% endblock %}

{% block content %}
<div class="page-h">
    <h2><i class="fas fa-history me-2"></i>–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫</h2>
    <p>–í—Å–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –æ—à–∏–±–æ–∫</p>
</div>

<div class="mb-3">
    <a href="/broadcast" class="btn btn-outline-primary"><i class="fas fa-arrow-left me-1"></i>–ù–∞–∑–∞–¥ –∫ —Ä–∞—Å—Å—ã–ª–∫–∞–º</a>
</div>

{% if history %}
<div class="table-card">
    <div class="card-header"><i class="fas fa-list me-2"></i>–†–∞—Å—Å—ã–ª–∫–∏ ({{ history|length }})</div>
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead>
                <tr>
                    <th>#</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                    <th>–¢–µ–∫—Å—Ç</th>
                    <th>–í—Å–µ–≥–æ</th>
                    <th>‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</th>
                    <th>‚ùå –û—à–∏–±–∫–∏</th>
                    <th>üö´ –ë–ª–æ–∫</th>
                    <th>üìä Rate</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for run in history %}
                <tr>
                    <td class="fw-bold">#{{ run.id }}</td>
                    <td>
                        <small>{{ run.started_at[:16] if run.started_at else '‚Äî' }}</small>
                    </td>
                    <td>
                        {% if run.source == 'web' %}
                            <span class="badge bg-info">Web</span>
                        {% else %}
                            <span class="badge bg-primary">Bot</span>
                        {% endif %}
                    </td>
                    <td>
                        <span title="{{ run.text_preview }}">
                            {{ (run.text_preview or '‚Äî')[:60] }}{% if run.text_preview and run.text_preview|length > 60 %}‚Ä¶{% endif %}
                        </span>
                    </td>
                    <td class="fw-bold">{{ run.total_users or 0 }}</td>
                    <td class="text-success fw-bold">{{ run.sent_count or 0 }}</td>
                    <td class="text-danger fw-bold">{{ run.failed_count or 0 }}</td>
                    <td class="text-warning fw-bold">{{ run.blocked_count or 0 }}</td>
                    <td>
                        {% set rate = run.delivery_rate or 0 %}
                        <span class="badge {% if rate >= 90 %}bg-success{% elif rate >= 70 %}bg-warning text-dark{% else %}bg-danger{% endif %}">
                            {{ rate }}%
                        </span>
                    </td>
                    <td>
                        {% if run.status == 'done' %}
                            <span class="badge bg-success">–ì–æ—Ç–æ–≤–æ</span>
                        {% elif run.status == 'running' %}
                            <span class="badge bg-warning text-dark">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
                        {% else %}
                            <span class="badge bg-secondary">{{ run.status }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="/broadcast/details/{{ run.id }}" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye"></i> –î–µ—Ç–∞–ª–∏
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="alert alert-info">
    <i class="fas fa-info-circle me-2"></i>
    –ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–∫–∞—Ö. –ü–æ—Å–ª–µ —Å–ª–µ–¥—É—é—â–µ–π —Ä–∞—Å—Å—ã–ª–∫–∏ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.
</div>
{% endif %}
{% endblock %}
