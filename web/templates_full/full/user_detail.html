{% extends "full/base.html" %}
{% block title %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {{ user.user_id }}{% endblock %}

{% block content %}
<div class="page-h">
    <a href="/users" class="btn btn-sm btn-outline-primary mb-2"><i class="fas fa-arrow-left me-1"></i>–ù–∞–∑–∞–¥</a>
    <h2><i class="fas fa-user me-2"></i>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
</div>

<div class="row g-3">
    <!-- Main info -->
    <div class="col-lg-6">
        <div class="table-card">
            <div class="card-header"><i class="fas fa-id-card me-2"></i>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
            <div class="p-3">
                <table class="table table-sm">
                    <tr><td class="fw-bold" style="width:180px">Telegram ID</td><td><code>{{ user.user_id }}</code></td></tr>
                    <tr><td class="fw-bold">Username</td><td>{% if user.username %}<a href="https://t.me/{{ user.username }}" target="_blank">@{{ user.username }}</a>{% else %}‚Äî{% endif %}</td></tr>
                    <tr><td class="fw-bold">–ò–º—è (Telegram)</td><td>{{ user.first_name or '‚Äî' }}</td></tr>
                    <tr><td class="fw-bold">–ù–∞—Å—Ç–æ—è—â–µ–µ –∏–º—è</td><td>{{ user.real_name or '‚Äî' }}</td></tr>
                    <tr><td class="fw-bold">–¢–µ–ª–µ—Ñ–æ–Ω</td><td>{{ user.phone_number or '‚Äî' }}</td></tr>
                    <tr><td class="fw-bold">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</td><td>{{ user.birth_date or '‚Äî' }}</td></tr>
                    <tr><td class="fw-bold">AI-–∫–æ–Ω—Ü–µ–ø—Ü–∏—è</td><td>{{ user.ai_concept or 'evgenich' }}</td></tr>
                    <tr><td class="fw-bold">–ü—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω</td><td>{{ '‚úÖ –î–∞' if user.profile_completed else '‚ùå –ù–µ—Ç' }}</td></tr>
                </table>
            </div>
        </div>
    </div>

    <!-- Status & dates -->
    <div class="col-lg-6">
        <div class="table-card mb-3">
            <div class="card-header"><i class="fas fa-info-circle me-2"></i>–°—Ç–∞—Ç—É—Å –∏ –¥–∞—Ç—ã</div>
            <div class="p-3">
                <table class="table table-sm">
                    <tr>
                        <td class="fw-bold" style="width:180px">–°—Ç–∞—Ç—É—Å</td>
                        <td>
                            {% if user.status == 'registered' %}<span class="badge bg-info">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω</span>
                            {% elif user.status == 'issued' %}<span class="badge bg-warning text-dark">–ö—É–ø–æ–Ω –≤—ã–¥–∞–Ω</span>
                            {% elif user.status == 'redeemed' %}<span class="badge bg-success">–ü–æ–≥–∞—à–µ–Ω–æ</span>
                            {% elif user.status == 'redeemed_and_left' %}<span class="badge bg-danger">–û—Ç–ø–∏—Å–∞–ª—Å—è</span>
                            {% else %}<span class="badge bg-secondary">{{ user.status or '‚Äî' }}</span>{% endif %}
                        </td>
                    </tr>
                    <tr><td class="fw-bold">–ò—Å—Ç–æ—á–Ω–∏–∫</td><td><span class="badge bg-secondary">{{ user.source or '‚Äî' }}</span></td></tr>
                    <tr><td class="fw-bold">–†–µ—Ñ–µ—Ä–µ—Ä</td><td>{% if user.referrer_id %}<a href="/users/{{ user.referrer_id }}">{{ user.referrer_id }}</a>{% else %}‚Äî{% endif %}</td></tr>
                    <tr><td class="fw-bold">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</td><td>{{ user.brought_by_staff_id or '‚Äî' }}</td></tr>
                    <tr><td class="fw-bold">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</td><td>{{ user.register_date or '‚Äî' }}</td></tr>
                    <tr><td class="fw-bold">–ö—É–ø–æ–Ω –≤—ã–¥–∞–Ω</td><td>{{ user.redeem_date or '‚Äî' }}</td></tr>
                    <tr><td class="fw-bold">–ö–æ–Ω—Ç–∞–∫—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω</td><td>{{ user.contact_shared_date or '‚Äî' }}</td></tr>
                    <tr><td class="fw-bold">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞</td><td>{{ 'üö´ –î–∞' if user.blocked else '‚Äî' }}</td></tr>
                </table>
            </div>
        </div>

        {% if referral_stats %}
        <div class="table-card">
            <div class="card-header"><i class="fas fa-share-alt me-2"></i>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <div class="p-3">
                <table class="table table-sm">
                    <tr><td class="fw-bold">–í—Å–µ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–æ</td><td>{{ referral_stats.total or 0 }}</td></tr>
                    <tr><td class="fw-bold">–ü–æ–≥–∞—Å–∏–ª–∏ –Ω–∞—Å—Ç–æ–π–∫—É</td><td>{{ referral_stats.redeemed or 0 }}</td></tr>
                    <tr><td class="fw-bold">–ù–∞–≥—Ä–∞–¥ –ø–æ–ª—É—á–µ–Ω–æ</td><td>{{ referral_stats.rewarded or 0 }}</td></tr>
                </table>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Actions -->
<div class="row g-3 mt-2">
    <div class="col-lg-6">
        <div class="table-card">
            <div class="card-header"><i class="fas fa-cog me-2"></i>–î–µ–π—Å—Ç–≤–∏—è</div>
            <div class="p-3">
                <form method="POST" action="/users/{{ user.user_id }}/action" class="mb-3">
                    <input type="hidden" name="action" value="update_status">
                    <label class="form-label">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å</label>
                    <div class="d-flex gap-2">
                        <select name="status" class="form-select">
                            <option value="registered" {{ 'selected' if user.status=='registered' }}>registered</option>
                            <option value="issued" {{ 'selected' if user.status=='issued' }}>issued</option>
                            <option value="redeemed" {{ 'selected' if user.status=='redeemed' }}>redeemed</option>
                            <option value="redeemed_and_left" {{ 'selected' if user.status=='redeemed_and_left' }}>redeemed_and_left</option>
                        </select>
                        <button class="btn btn-primary"><i class="fas fa-save"></i></button>
                    </div>
                </form>

                <form method="POST" action="/users/{{ user.user_id }}/action" class="mb-3">
                    <input type="hidden" name="action" value="update_source">
                    <label class="form-label">–ò–∑–º–µ–Ω–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫</label>
                    <div class="d-flex gap-2">
                        <input type="text" name="source" class="form-control" value="{{ user.source or '' }}">
                        <button class="btn btn-primary"><i class="fas fa-save"></i></button>
                    </div>
                </form>

                <hr>
                <form method="POST" action="/users/{{ user.user_id }}/action"
                      onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user.user_id }}?')">
                    <input type="hidden" name="action" value="delete">
                    <button class="btn btn-danger"><i class="fas fa-trash me-1"></i>–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
