{% extends "full/base.html" %}
{% block title %}Персонал{% endblock %}

{% block content %}
<div class="page-h">
    <h2><i class="fas fa-id-badge me-2"></i>Персонал</h2>
    <p>Управление сотрудниками и ролями доступа</p>
</div>

<div class="row g-3">
    <!-- Staff list from DB -->
    <div class="col-lg-7">
        <div class="table-card">
            <div class="card-header d-flex align-items-center justify-content-between">
                <span><i class="fas fa-users me-2"></i>Сотрудники (из БД)</span>
            </div>
            <div style="overflow-x:auto">
                <table class="table table-hover">
                    <thead>
                        <tr><th>ID</th><th>Имя</th><th>Должность</th><th>Код</th><th>Статус</th><th></th></tr>
                    </thead>
                    <tbody>
                    {% for s in staff %}
                    <tr>
                        <td><code>{{ s.staff_id or s.telegram_id or '—' }}</code></td>
                        <td>{{ s.full_name or '—' }}</td>
                        <td><span class="badge bg-secondary">{{ s.position or '—' }}</span></td>
                        <td><code>{{ s.unique_code or '—' }}</code></td>
                        <td>
                            {% set st = s.status or 'active' %}
                            {% if st == 'active' %}<span class="badge bg-success">Активен</span>
                            {% else %}<span class="badge bg-danger">Неактивен</span>{% endif %}
                        </td>
                        <td>
                            <form method="POST" action="/staff/{{ s.staff_id or s.telegram_id or 0 }}/toggle" class="d-inline">
                                {% if (s.status or 'active') == 'active' %}
                                <input type="hidden" name="status" value="inactive">
                                <button class="btn btn-sm btn-outline-danger" title="Деактивировать"><i class="fas fa-pause"></i></button>
                                {% else %}
                                <input type="hidden" name="status" value="active">
                                <button class="btn btn-sm btn-outline-success" title="Активировать"><i class="fas fa-play"></i></button>
                                {% endif %}
                            </form>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="6" class="text-center text-muted py-4">Нет зарегистрированных сотрудников</td></tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Roles -->
    <div class="col-lg-5">
        <!-- Bosses -->
        <div class="table-card mb-3">
            <div class="card-header" style="background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff">
                <i class="fas fa-crown me-2"></i>Боссы
            </div>
            <div class="p-3">
                {% for u in roles.bosses %}
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <span><code>{{ u.id }}</code> — {{ u.name }}</span>
                    <form method="POST" action="/staff/role" class="d-inline">
                        <input type="hidden" name="action" value="remove">
                        <input type="hidden" name="role" value="boss">
                        <input type="hidden" name="user_id" value="{{ u.id }}">
                        <button class="btn btn-sm btn-outline-danger"><i class="fas fa-times"></i></button>
                    </form>
                </div>
                {% endfor %}
                <form method="POST" action="/staff/role" class="mt-3">
                    <input type="hidden" name="action" value="add">
                    <input type="hidden" name="role" value="boss">
                    <div class="d-flex gap-2">
                        <input type="number" name="user_id" class="form-control form-control-sm" placeholder="Telegram ID" required>
                        <input type="text" name="name" class="form-control form-control-sm" placeholder="Имя">
                        <button class="btn btn-sm btn-danger"><i class="fas fa-plus"></i></button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Admins -->
        <div class="table-card mb-3">
            <div class="card-header" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff">
                <i class="fas fa-user-shield me-2"></i>Админы
            </div>
            <div class="p-3">
                {% for u in roles.admins %}
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <span><code>{{ u.id }}</code> — {{ u.name }}</span>
                    <form method="POST" action="/staff/role" class="d-inline">
                        <input type="hidden" name="action" value="remove">
                        <input type="hidden" name="role" value="admin">
                        <input type="hidden" name="user_id" value="{{ u.id }}">
                        <button class="btn btn-sm btn-outline-danger"><i class="fas fa-times"></i></button>
                    </form>
                </div>
                {% endfor %}
                <form method="POST" action="/staff/role" class="mt-3">
                    <input type="hidden" name="action" value="add">
                    <input type="hidden" name="role" value="admin">
                    <div class="d-flex gap-2">
                        <input type="number" name="user_id" class="form-control form-control-sm" placeholder="Telegram ID" required>
                        <input type="text" name="name" class="form-control form-control-sm" placeholder="Имя">
                        <button class="btn btn-sm btn-primary"><i class="fas fa-plus"></i></button>
                    </div>
                </form>
            </div>
        </div>

        <!-- SMM -->
        <div class="table-card">
            <div class="card-header" style="background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff">
                <i class="fas fa-bullhorn me-2"></i>SMM
            </div>
            <div class="p-3">
                {% for u in roles.smm %}
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <span><code>{{ u.id }}</code> — {{ u.name }}</span>
                    <form method="POST" action="/staff/role" class="d-inline">
                        <input type="hidden" name="action" value="remove">
                        <input type="hidden" name="role" value="smm">
                        <input type="hidden" name="user_id" value="{{ u.id }}">
                        <button class="btn btn-sm btn-outline-danger"><i class="fas fa-times"></i></button>
                    </form>
                </div>
                {% endfor %}
                <form method="POST" action="/staff/role" class="mt-3">
                    <input type="hidden" name="action" value="add">
                    <input type="hidden" name="role" value="smm">
                    <div class="d-flex gap-2">
                        <input type="number" name="user_id" class="form-control form-control-sm" placeholder="Telegram ID" required>
                        <input type="text" name="name" class="form-control form-control-sm" placeholder="Имя">
                        <button class="btn btn-sm btn-warning"><i class="fas fa-plus"></i></button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
