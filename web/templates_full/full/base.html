<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}–ü–∞–Ω–µ–ª—å{% endblock %} ‚Ä¢ –ï–≤–≥–µ–Ω–∏—á</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <style>
        :root{
            --c1:#6366f1;--c2:#8b5cf6;--ok:#10b981;--no:#ef4444;
            --warn:#f59e0b;--info:#3b82f6;--bg:#f8fafc;--border:#e2e8f0;
            --sidebar-w:260px;
        }
        *{font-family:'Inter',system-ui,sans-serif;box-sizing:border-box}
        body{margin:0;background:var(--bg);color:#1e293b;min-height:100vh;display:flex}

        /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
        .sidebar{
            width:var(--sidebar-w);min-height:100vh;background:#1e1b4b;
            color:#e0e7ff;position:fixed;top:0;left:0;z-index:100;
            transition:transform .3s;display:flex;flex-direction:column;
        }
        .sidebar-brand{padding:1.5rem;text-align:center;border-bottom:1px solid rgba(255,255,255,.1)}
        .sidebar-brand h4{margin:0;color:#a5b4fc;font-weight:800;font-size:1.4rem;letter-spacing:1px}
        .sidebar-brand small{color:#818cf8;font-size:.75rem}
        .sidebar-nav{flex:1;padding:.5rem 0;overflow-y:auto}
        .sidebar-nav a{
            display:flex;align-items:center;padding:.75rem 1.25rem;color:#c7d2fe;
            text-decoration:none;font-size:.9rem;font-weight:500;
            transition:all .15s;border-left:3px solid transparent;
        }
        .sidebar-nav a:hover{background:rgba(99,102,241,.15);color:#fff;border-left-color:#818cf8}
        .sidebar-nav a.active{background:rgba(99,102,241,.25);color:#fff;border-left-color:var(--c1)}
        .sidebar-nav a i{width:22px;margin-right:.75rem;text-align:center;font-size:.95rem}
        .sidebar-nav .divider{border-top:1px solid rgba(255,255,255,.08);margin:.5rem 1rem}
        .sidebar-footer{padding:1rem 1.25rem;border-top:1px solid rgba(255,255,255,.1);font-size:.8rem}

        /* ‚îÄ‚îÄ Main ‚îÄ‚îÄ */
        .main{margin-left:var(--sidebar-w);flex:1;min-height:100vh}
        .topbar{
            background:#fff;border-bottom:1px solid var(--border);
            padding:.75rem 1.5rem;display:flex;align-items:center;
            justify-content:space-between;position:sticky;top:0;z-index:50;
        }
        .topbar .btn-menu{display:none;background:none;border:none;font-size:1.3rem;color:#64748b}
        .content{padding:1.5rem}

        /* Cards */
        .stat-card{
            background:#fff;border:1px solid var(--border);border-radius:.75rem;
            padding:1.25rem;transition:all .2s;position:relative;overflow:hidden;
        }
        .stat-card:hover{border-color:var(--c1);box-shadow:0 4px 12px rgba(99,102,241,.12)}
        .stat-card .icon{
            width:48px;height:48px;border-radius:.6rem;display:flex;
            align-items:center;justify-content:center;font-size:1.2rem;color:#fff;
        }
        .stat-card h3{font-size:1.8rem;font-weight:800;margin:.5rem 0 0}
        .stat-card small{color:#64748b;font-size:.8rem}

        /* Table */
        .table-card{background:#fff;border:1px solid var(--border);border-radius:.75rem;overflow:hidden}
        .table-card .card-header{
            background:#f8fafc;border-bottom:1px solid var(--border);
            padding:1rem 1.25rem;font-weight:700;font-size:1rem;
        }
        .table{margin:0;font-size:.88rem}
        .table thead th{background:#f8fafc;font-weight:700;color:#475569;border-bottom:2px solid var(--border);padding:.75rem 1rem}
        .table td{padding:.75rem 1rem;vertical-align:middle;border-bottom:1px solid #f1f5f9}
        .table-hover tbody tr:hover{background:#f8fafc}

        /* Forms */
        .form-control,.form-select{border:1px solid var(--border);border-radius:.5rem;padding:.6rem .9rem;font-size:.9rem}
        .form-control:focus,.form-select:focus{border-color:var(--c1);box-shadow:0 0 0 3px rgba(99,102,241,.1)}
        .form-label{font-weight:600;font-size:.85rem;color:#334155;margin-bottom:.3rem}

        /* Buttons */
        .btn{font-weight:600;border-radius:.5rem;padding:.5rem 1rem;font-size:.88rem;transition:all .15s}
        .btn-primary{background:var(--c1);border-color:var(--c1);color:#fff}
        .btn-primary:hover{background:#4f46e5;transform:translateY(-1px);box-shadow:0 4px 8px rgba(99,102,241,.25)}
        .btn-success{background:var(--ok);border-color:var(--ok);color:#fff}
        .btn-danger{background:var(--no);border-color:var(--no);color:#fff}
        .btn-warning{background:var(--warn);border-color:var(--warn);color:#fff}
        .btn-outline-primary{color:var(--c1);border-color:var(--c1)}
        .btn-outline-primary:hover{background:var(--c1);color:#fff}

        /* Badges */
        .badge{font-weight:600;padding:.35rem .65rem;border-radius:.35rem;font-size:.75rem}
        .badge-status{display:inline-flex;align-items:center;gap:.35rem}
        .badge-status::before{content:'';width:7px;height:7px;border-radius:50%;display:block}
        .badge-registered::before{background:var(--info)}
        .badge-issued::before{background:var(--warn)}
        .badge-redeemed::before{background:var(--ok)}
        .badge-left::before{background:var(--no)}

        /* Alerts */
        .alert{border-radius:.5rem;border:1px solid;font-size:.9rem}

        /* Page header */
        .page-h{margin-bottom:1.5rem}
        .page-h h2{font-size:1.6rem;font-weight:800;color:#1e293b;margin:0}
        .page-h p{color:#64748b;font-size:.9rem;margin:.25rem 0 0}

        /* Modal */
        .modal-content{border:1px solid var(--border);border-radius:.75rem}
        .modal-header{border-bottom:1px solid var(--border)}
        .modal-title{font-weight:700}

        /* Responsive */
        @media(max-width:991px){
            .sidebar{transform:translateX(-100%)}
            .sidebar.open{transform:translateX(0)}
            .main{margin-left:0}
            .topbar .btn-menu{display:block}
            .overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:99;display:none}
            .overlay.show{display:block}
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-brand">
            <h4>üç∑ –ï–í–ì–ï–ù–ò–ß</h4>
            <small>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</small>
        </div>
        <nav class="sidebar-nav">
            <a href="/" class="{{ 'active' if request.path == '/' }}">
                <i class="fas fa-chart-pie"></i> –î–∞—à–±–æ—Ä–¥
            </a>
            <a href="/users" class="{{ 'active' if '/users' in request.path }}">
                <i class="fas fa-users"></i> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            </a>
            <a href="/analytics" class="{{ 'active' if '/analytics' in request.path }}">
                <i class="fas fa-chart-line"></i> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
            </a>
            <a href="/broadcast" class="{{ 'active' if '/broadcast' in request.path }}">
                <i class="fas fa-bullhorn"></i> –†–∞—Å—Å—ã–ª–∫–∏
            </a>
            <div class="divider"></div>
            <a href="/staff" class="{{ 'active' if '/staff' in request.path }}">
                <i class="fas fa-id-badge"></i> –ü–µ—Ä—Å–æ–Ω–∞–ª
            </a>
            <a href="/promotions" class="{{ 'active' if '/promotions' in request.path }}">
                <i class="fas fa-tags"></i> –ê–∫—Ü–∏–∏
            </a>
            <div class="divider"></div>
            <a href="/ai" class="{{ 'active' if '/ai' in request.path }}">
                <i class="fas fa-robot"></i> AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç
            </a>
            <a href="/bars" class="{{ 'active' if '/bars' in request.path }}">
                <i class="fas fa-store"></i> –ë–∞—Ä—ã
            </a>
            <a href="/texts" class="{{ 'active' if '/texts' in request.path }}">
                <i class="fas fa-align-left"></i> –¢–µ–∫—Å—Ç—ã
            </a>
            <a href="/links" class="{{ 'active' if '/links' in request.path }}">
                <i class="fas fa-link"></i> –°—Å—ã–ª–∫–∏
            </a>
            <div class="divider"></div>
            <a href="/sync" class="{{ 'active' if '/sync' in request.path }}">
                <i class="fas fa-sync-alt"></i> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
            </a>
        </nav>
        <div class="sidebar-footer">
            <i class="fas fa-circle text-success" style="font-size:.5rem"></i>
            –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
        </div>
    </aside>

    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- Main -->
    <div class="main">
        <div class="topbar">
            <button class="btn-menu" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
            <div style="font-weight:600;color:#64748b;font-size:.85rem">
                <i class="fas fa-clock me-1"></i>
                <span id="clock"></span>
            </div>
            <a href="/logout" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-sign-out-alt me-1"></i>–í—ã—Ö–æ–¥
            </a>
        </div>

        <div class="content">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for cat, msg in messages %}
                <div class="alert alert-{{ 'success' if cat == 'success' else 'danger' }} alert-dismissible fade show" role="alert">
                    {{ msg }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endfor %}
            {% endif %}
            {% endwith %}

            {% block content %}{% endblock %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function toggleSidebar(){
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('show');
        }
        function updateClock(){
            const d=new Date();
            document.getElementById('clock').textContent=
                d.toLocaleString('ru-RU',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'});
        }
        setInterval(updateClock,1000);updateClock();
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
