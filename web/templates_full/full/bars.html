{% extends "full/base.html" %}
{% block title %}–ë–∞—Ä—ã{% endblock %}

{% block content %}
<div class="page-h d-flex align-items-center justify-content-between flex-wrap">
    <div>
        <h2><i class="fas fa-store me-2"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞—Ä–∞–º–∏</h2>
        <p>–°–ø–∏—Å–æ–∫ –∑–∞–≤–µ–¥–µ–Ω–∏–π –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</p>
    </div>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">
        <i class="fas fa-plus me-1"></i>–î–æ–±–∞–≤–∏—Ç—å –±–∞—Ä
    </button>
</div>

<div class="row g-3">
    {% for bar in bars %}
    <div class="col-lg-4 col-md-6">
        <div class="table-card h-100">
            <div class="card-header">
                {{ bar.emoji or 'üç∑' }} {{ bar.name }}
                <span class="badge bg-light text-dark float-end">{{ bar.code }}</span>
            </div>
            <div class="p-3">
                <form method="POST" action="/bars/save">
                    <input type="hidden" name="action" value="edit">
                    <input type="hidden" name="callback_id" value="{{ bar.callback_id }}">

                    <div class="mb-2">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" name="name" class="form-control form-control-sm" value="{{ bar.name }}">
                    </div>
                    <div class="row mb-2">
                        <div class="col-8">
                            <label class="form-label">–ö–æ–¥</label>
                            <input type="text" name="code" class="form-control form-control-sm" value="{{ bar.code }}">
                        </div>
                        <div class="col-4">
                            <label class="form-label">–≠–º–æ–¥–∑–∏</label>
                            <input type="text" name="emoji" class="form-control form-control-sm" value="{{ bar.emoji }}">
                        </div>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="text" name="phone" class="form-control form-control-sm" value="{{ bar.phone or '' }}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ú–µ–Ω—é URL</label>
                        <input type="url" name="menu_url" class="form-control form-control-sm" value="{{ bar.menu_url or '' }}">
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-sm btn-primary flex-fill"><i class="fas fa-save me-1"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button type="button" class="btn btn-sm btn-outline-danger"
                                onclick="deleteBar('{{ bar.callback_id }}','{{ bar.name }}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Add modal -->
<div class="modal fade" id="addModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –±–∞—Ä</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <form method="POST" action="/bars/save">
                <input type="hidden" name="action" value="add">
                <div class="modal-body">
                    <div class="mb-3"><label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" name="name" class="form-control" required></div>
                    <div class="mb-3"><label class="form-label">–ö–æ–¥</label><input type="text" name="code" class="form-control" required placeholder="–ï–í–ì_–°–ü–ë"></div>
                    <div class="mb-3"><label class="form-label">Callback ID</label><input type="text" name="callback_id" class="form-control" required placeholder="bar_name"></div>
                    <div class="row mb-3">
                        <div class="col-6"><label class="form-label">–≠–º–æ–¥–∑–∏</label><input type="text" name="emoji" class="form-control" value="üç∑"></div>
                        <div class="col-6"><label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="text" name="phone" class="form-control"></div>
                    </div>
                    <div class="mb-3"><label class="form-label">–ú–µ–Ω—é URL</label><input type="url" name="menu_url" class="form-control"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-plus me-1"></i>–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete form -->
<form id="deleteForm" method="POST" action="/bars/save" style="display:none">
    <input type="hidden" name="action" value="delete">
    <input type="hidden" name="callback_id" id="delBarId">
</form>
{% endblock %}

{% block scripts %}
<script>
function deleteBar(id, name){
    if(confirm(`–£–¥–∞–ª–∏—Ç—å –±–∞—Ä ¬´${name}¬ª?`)){
        document.getElementById('delBarId').value=id;
        document.getElementById('deleteForm').submit();
    }
}
</script>
{% endblock %}
