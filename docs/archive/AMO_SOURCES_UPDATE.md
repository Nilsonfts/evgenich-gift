# 📋 ОБНОВЛЕНИЕ СИСТЕМЫ ИСТОЧНИКОВ ТРАФИКА - АМО ИНТЕГРАЦИЯ

## 🎯 Задача выполнена

Обновлена система источников трафика для админского бронирования с добавлением тегов для АМО.

## 📊 Изменения в источниках

### Старые источники → Новые источники

| Старый callback | Новый callback | Отображение | Тег АМО |
|----------------|----------------|-------------|---------|
| `source_instagram` | `source_inst` | Instagram | `inst` |
| `source_tg_booking` | `source_bot_tg` | Бот в ТГ | `bot_tg` |
| `source_tg_channel` | `source_tg` | ТГ-канал | `tg` |
| `source_vk` | `source_vk` | ВКонтакте | `vk` |

## 📋 Структура таблицы Google Sheets

В таблице "Заявки из Соц сетей" теперь **11 колонок** с новой колонкой H:

| Колонка | Название | Описание |
|---------|----------|----------|
| A | Дата Заявки | Дата и время создания заявки (DD.MM.YYYY HH:MM) |
| B | Имя Гостя | Имя клиента |
| C | Телефон | Номер телефона |
| D | Дата посещения | Дата бронирования (DD.MM.YYYY) |
| E | Время | Время бронирования |
| F | Кол-во гостей | Количество гостей |
| G | Источник | Читаемое название источника (ВКонтакте, Instagram, и т.д.) |
| **H** | **ТЕГ для АМО** | **Короткий тег: vk, inst, bot_tg, tg** |
| I | Повод Визита | Причина визита |
| J | Кто создал заявку | Имя админа (Нил Владимирович, Кристина, и т.д.) |
| K | Статус | Всегда "Новая" при создании |

## 🔘 Кнопки в боте

Обновленная клавиатура выбора источника трафика:

```
┌─────────────────┬─────────────────┐
│ 📘 ВКонтакте    │ 📸 Instagram    │
├─────────────────┼─────────────────┤
│ 🤖 Бот в ТГ     │ 📢 ТГ-канал     │
└─────────────────┴─────────────────┘
```

- **📘 ВКонтакте** → `source_vk` → тег АМО: `vk`
- **📸 Instagram** → `source_inst` → тег АМО: `inst`  
- **🤖 Бот в ТГ** → `source_bot_tg` → тег АМО: `bot_tg`
- **📢 ТГ-канал** → `source_tg` → тег АМО: `tg`

## 📁 Измененные файлы

### 1. `keyboards.py`
- Обновлена функция `get_traffic_source_keyboard()`
- Изменены callback_data для кнопок

### 2. `social_bookings_export.py`
- Добавлен `amo_tag_mapping` для тегов АМО
- Обновлен `source_mapping` с новыми источниками
- В `row_data` добавлена колонка H с тегом АМО

### 3. `texts.py`
- Обновлены словари `source_names` в функциях:
  - `get_booking_confirmation_text()`
  - `get_booking_report_text()`

## 🧪 Тестирование

Создан файл `test_new_sources_updated.py` для проверки:

```bash
python test_new_sources_updated.py
```

Показывает:
- Маппинг всех источников
- Структуру таблицы
- Примеры данных для каждого источника

## ✅ Результат

Теперь при создании админской брони:

1. **Админ выбирает источник** из обновленной клавиатуры
2. **Система сохраняет** правильный callback (source_vk, source_inst, etc.)
3. **Экспорт в Google Sheets** добавляет строку с:
   - Читаемым названием в колонке G (ВКонтакте, Instagram, etc.)
   - **Коротким тегом в колонке H** (vk, inst, bot_tg, tg)
4. **Колонка H используется для АМО** - автоматическая интеграция

Система готова к использованию! 🎉
