# üç∑ –°–∏—Å—Ç–µ–º–∞ –≤—ã–±–æ—Ä–∞ –±–∞—Ä–æ–≤ –≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏

## –û–ø–∏—Å–∞–Ω–∏–µ
–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–æ–ª–∏–∫–æ–≤ - —Ç–µ–ø–µ—Ä—å –≤–º–µ—Å—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è "–ø–æ–≤–æ–¥" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≤—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–∞—Ä–∞** —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏.

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –±–∞—Ä—ã
1. **–ù–µ–≤—Å–∫–∏–π** - –∫–æ–¥: `–ï–í–ì_–°–ü–ë_–ù–ï–í`
2. **–†—É–±–∏–Ω—à—Ç–µ–π–Ω–∞** - –∫–æ–¥: `–ï–í–ì_–°–ü–ë_–†–£–ë`

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. keyboards/__init__.py
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_bar_selection_keyboard()` - inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã–±–æ—Ä–∞ –±–∞—Ä–∞

### 2. texts/__init__.py
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `BOOKING_ASK_BAR` –¥–ª—è –≥–æ—Å—Ç–µ–≤–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `ADMIN_BOOKING_REASON` –Ω–∞ `ADMIN_BOOKING_BAR` –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_booking_confirmation_text()` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∞—Ä–∞ –≤–º–µ—Å—Ç–æ "–ø–æ–≤–æ–¥–∞"
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_booking_report_text()` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∞—Ä–∞ –≤ –æ—Ç—á–µ—Ç–µ

### 3. handlers/booking_flow.py
- ‚úÖ –ó–∞–º–µ–Ω—ë–Ω —à–∞–≥ `'reason'` –Ω–∞ `'bar'` –≤ –æ–±–æ–∏—Ö –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞—Ö (user_prompts –∏ admin_prompts)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω callback `handle_traffic_source_callback()` - —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ `bar` –≤–º–µ—Å—Ç–æ `reason`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π callback `handle_bar_selection_callback()` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –±–∞—Ä–∞:
  - –ú–∞–ø–ø–∏—Ä—É–µ—Ç `bar_nevsky` ‚Üí `'–ï–í–ì_–°–ü–ë_–ù–ï–í'`
  - –ú–∞–ø–ø–∏—Ä—É–µ—Ç `bar_rubinstein` ‚Üí `'–ï–í–ì_–°–ü–ë_–†–£–ë'`
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–¥ –≤ `booking_data['amo_tag']`
  - –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É –∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥)

### 4. utils/social_bookings_export.py
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `export_social_booking_to_sheets()`:
  - –¢–µ–ø–µ—Ä—å amo_tag –±–µ—Ä–µ—Ç—Å—è –∏–∑ `booking_data.get('amo_tag')` –µ—Å–ª–∏ –µ—Å—Ç—å (–∫–æ–¥ –±–∞—Ä–∞)
  - –ï—Å–ª–∏ –Ω–µ—Ç amo_tag, —Ç–æ –±–µ—Ä–µ—Ç—Å—è –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
  - –ó–∞–º–µ–Ω–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ H —Å "–ü–æ–≤–æ–¥ –í–∏–∑–∏—Ç–∞" –Ω–∞ "–ö–æ–¥ –±–∞—Ä–∞ –¥–ª—è –ê–ú–û"

- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `export_guest_booking_to_sheets()`:
  - amo_tag —Ç–µ–ø–µ—Ä—å –±–µ—Ä–µ—Ç—Å—è –∏–∑ `booking_data.get('amo_tag')` –∏–ª–∏ `'guest_bot'`
  - –ó–∞–º–µ–Ω–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ H –Ω–∞ "–ö–æ–¥ –±–∞—Ä–∞ –¥–ª—è –ê–ú–û"

- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `export_booking_to_secondary_table()`:
  - –ö–æ–ª–æ–Ω–∫–∞ E —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `booking_data.get('amo_tag')` –≤–º–µ—Å—Ç–æ "–ï–í–ì_–°–ü–ë"
  - –ö–æ–ª–æ–Ω–∫–∞ H —Ç–µ–ø–µ—Ä—å –ø—É—Å—Ç–∞—è (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

## –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–ª—è –≥–æ—Å—Ç–µ–π (—á–µ—Ä–µ–∑ –±–æ—Ç–∞):
1. `/start` ‚Üí "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª"
2. –ò–º—è –≥–æ—Å—Ç—è
3. –¢–µ–ª–µ—Ñ–æ–Ω
4. –î–∞—Ç–∞ –ø–æ—Å–µ—â–µ–Ω–∏—è
5. –í—Ä–µ–º—è –ø–æ—Å–µ—â–µ–Ω–∏—è
6. –ö–æ–ª-–≤–æ –≥–æ—Å—Ç–µ–π
7. **[–ù–û–í–û–ï] –í—ã–±–æ—Ä –±–∞—Ä–∞** (–ù–µ–≤—Å–∫–∏–π / –†—É–±–∏–Ω—à—Ç–µ–π–Ω–∞)
8. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
9. –£—Å–ø–µ—Ö! ‚úÖ

### –î–ª—è –∞–¥–º–∏–Ω–æ–≤/—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (—Å–æ–∑–¥–∞–Ω–∏–µ –≤—Ä—É—á–Ω—É—é):
1. "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ë–†–û–ù–¨"
2. –ò–º—è –≥–æ—Å—Ç—è
3. –¢–µ–ª–µ—Ñ–æ–Ω
4. –î–∞—Ç–∞ –ø–æ—Å–µ—â–µ–Ω–∏—è
5. –í—Ä–µ–º—è –ø–æ—Å–µ—â–µ–Ω–∏—è
6. –ö–æ–ª-–≤–æ –≥–æ—Å—Ç–µ–π
7. –ò—Å—Ç–æ—á–Ω–∏–∫ (–í–ö / –ò–Ω—Å—Ç–∞–≥—Ä–∞–º / –ë–æ—Ç –¢–ì / –ó–∞–±—Ä–æ–Ω–∏—Ä—É–π –ï–≤–≥–µ–Ω–∏—á–∞)
8. **[–ù–û–í–û–ï] –í—ã–±–æ—Ä –±–∞—Ä–∞** (–ù–µ–≤—Å–∫–∏–π / –†—É–±–∏–Ω—à—Ç–µ–π–Ω–∞)
9. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
10. –£—Å–ø–µ—Ö! ‚úÖ

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Google Sheets (–∫–æ–ª–æ–Ω–∫–∏)

### –í–∫–ª–∞–¥–∫–∞ "–ó–∞—è–≤–∫–∏ –∏–∑ —Å–æ—Ü —Å–µ—Ç–µ–π"
| –ö–æ–ª–æ–Ω–∫–∞ | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ |
|---------|-----------|
| A | –î–∞—Ç–∞ –ó–∞—è–≤–∫–∏ |
| B | –ò–º—è –ì–æ—Å—Ç—è |
| C | –¢–µ–ª–µ—Ñ–æ–Ω |
| D | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ—Å–µ—â–µ–Ω–∏—è |
| E | –ö–æ–ª-–≤–æ –≥–æ—Å—Ç–µ–π |
| F | –ò—Å—Ç–æ—á–Ω–∏–∫ (–í–ö, –ò–Ω—Å—Ç–∞, –ë–æ—Ç, etc) |
| **G** | **–¢–ï–ì –¥–ª—è –ê–ú–û (–ö–æ–¥ –±–∞—Ä–∞: –ï–í–ì_–°–ü–ë_–ù–ï–í –∏–ª–∏ –ï–í–ì_–°–ü–ë_–†–£–ë)** |
| H | –ö—Ç–æ —Å–æ–∑–¥–∞–ª –∑–∞—è–≤–∫—É |
| I | –°—Ç–∞—Ç—É—Å |
| J-N | UTM-–º–µ—Ç–∫–∏ |
| O | ID –∑–∞—è–≤–∫–∏ |
| P | Telegram ID —Å–æ–∑–¥–∞—Ç–µ–ª—è |

## –ü—Ä–∏–º–µ—Ä—ã AMO-—Ç–µ–≥–æ–≤

```
–ù–µ–≤—Å–∫–∏–π:
- –ö–æ–ª–æ–Ω–∫–∞ G ‚Üí "–ï–í–ì_–°–ü–ë_–ù–ï–í"
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –≤ AMO

–†—É–±–∏–Ω—à—Ç–µ–π–Ω–∞:
- –ö–æ–ª–æ–Ω–∫–∞ G ‚Üí "–ï–í–ì_–°–ü–ë_–†–£–ë"
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –≤ AMO
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test_bar_selection.py` –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ú–∞–ø–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–æ–≤ –Ω–∞ –∫–æ–¥—ã –±–∞—Ä–æ–≤
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞

–ó–∞–ø—É—Å–∫:
```bash
python3 test_bar_selection.py
```

## –ó–∞–º–µ—Ç–∫–∏ –¥–ª—è Git

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã –¥–ª—è –∫–æ–º–º–∏—Ç–∞:
```bash
git add keyboards/__init__.py handlers/booking_flow.py texts/__init__.py utils/social_bookings_export.py
git commit -m "Feature: Replace booking reason with bar selection (Nevsky/Rubinstein)"
```

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —ç–∫—Å–ø–æ—Ä—Ç–æ–º –≤ Google Sheets
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å PostgreSQL (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `booking_data` dict)
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å TinyDB (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è)
- ‚úÖ –û–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º (—Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –Ω–µ –ø–æ—Å—Ç—Ä–∞–¥–∞—é—Ç)
