# Telegram-бот "Евгенич Настаивает"

Это репозиторий для многофункционального Telegram-бота рюмочной-квартирника "Евгенич". Бот служит для привлечения и удержания клиентов, предоставляя им подарки за подписку, реферальную программу, удобный доступ к меню и AI-ассистента для персональных рекомендаций.

## Основные возможности

* **Воронка "Подарок за подписку"**: Пользователи получают фирменную настойку за подписку на Telegram-канал.
* **AI-ассистент**: Интеграция с OpenAI (GPT-4o) для ответов на вопросы гостей в стиле "Евгенича" и рекомендаций по меню.
* **Интерактивное меню**: Просмотр меню настоек и кухни прямо в боте.
* **Система бронирования**: Многошаговый процесс бронирования столика через бота с уведомлением администраторов.
* **Реферальная программа**: Пользователи могут приглашать друзей и получать за это бонусы.
* **Панель администратора**: Встроенные отчеты и аналитика (конверсии, источники, когорты, лучшие рефералы).

## Структура проекта

Проект имеет модульную структуру для удобства поддержки и расширения.

* `main.py`: Главный файл для запуска бота.
* `config.py`: Считывание всех настроек и токенов из переменных окружения.
* `/handlers`: Папка с основной логикой бота, разделенной по функциональности.
    * `user_commands.py`: Основные команды (`/start`, `/menu` и т.д.).
    * `callback_query.py`: Обработка нажатий на inline-кнопки (меню, проверка подписки).
    * `booking_flow.py`: Логика пошагового бронирования стола.
    * `admin_panel.py`: Функционал для администраторов.
    * `ai_logic.py`: Обработка текстовых запросов к нейросети.
* `ai_assistant.py`: Логика взаимодействия с OpenAI API, включая системный промпт.
* `g_sheets.py`: Все функции для работы с Google Sheets.
* `keyboards.py`: Функции для генерации всех клавиатур бота.
* `texts.py`: Все текстовые константы, которые бот отправляет пользователям.
* `menu_nastoiki.py`, `food_menu.py`: Данные по меню.

## Установка и запуск

1.  **Клонируйте репозиторий:**
    ```bash
    git clone [https://github.com/Nilsonfts/evgenich-gift.git](https://github.com/Nilsonfts/evgenich-gift.git)
    cd evgenich-gift
    ```

2.  **Создайте и активируйте виртуальное окружение:**
    ```bash
    python -m venv venv
    source venv/bin/activate  # Для Windows: venv\Scripts\activate
    ```

3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Настройте переменные окружения:**
    Создайте в корне проекта файл `.env` и заполните его по следующему шаблону.

    ```dotenv
    # --- Telegram ---
    BOT_TOKEN="ВАШ_ТОКЕН_ОТ_BOTFATHER"
    CHANNEL_ID="@your_channel_name" # ID или юзернейм канала для подписки
    BOSS_ID="ID_АДМИНИСТРАТОРОВ_ЧЕРЕЗ_ЗАПЯТУЮ" # Например: 123456,789012
    REPORT_CHAT_ID="ID_ЧАТА_ДЛЯ_ОТЧЕТОВ_И_БРОНЕЙ" # Может быть равен BOSS_ID

    # --- Google Sheets ---
    # Ключ из URL вашей таблицы ([https://docs.google.com/spreadsheets/d/THIS_IS_THE_KEY/edit](https://docs.google.com/spreadsheets/d/THIS_IS_THE_KEY/edit))
    GOOGLE_SHEET_KEY="ВАШ_КЛЮЧ_GOOGLE_ТАБЛИЦЫ"
    # Содержимое вашего credentials.json файла в одну строку
    GOOGLE_CREDENTIALS_JSON='{"type": "service_account", ...}'

    # --- OpenAI ---
    OPENAI_API_KEY="sk-..."

    # --- Стикеры (получить с помощью @idstickerbot или get_id.py) ---
    HELLO_STICKER_ID="ID_ПРИВЕТСТВЕННОГО_СТИКЕРА"
    NASTOYKA_STICKER_ID="ID_СТИКЕРА_С_НАСТОЙКОЙ"
    THANK_YOU_STICKER_ID="ID_СТИКЕРА_СПАСИБО"
    FRIEND_BONUS_STICKER_ID="ID_СТИКЕРА_ДЛЯ_БОНУСА"

    # --- Ссылки ---
    MENU_URL="ССЫЛКА_НА_ПОЛНОЕ_МЕНЮ_НА_САЙТЕ"
    ```

5.  **Настройте Google Sheets:**
    Убедитесь, что у сервисного аккаунта из `credentials.json` есть права редактора в вашей таблице. Таблица должна содержать как минимум 3 листа:
    * `sheet1`: Основной лист для учета пользователей.
    * `conversation_history`: Для логирования диалогов с AI.
    * `daily_updates`: Для оперативного управления стоп-листом и спецпредложениями.

6.  **Запустите бота:**
    ```bash
    python main.py
    ```
